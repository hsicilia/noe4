{% extends 'base.html.twig' %}

{% set menu='ejemplar' %}

{% block title %}{{ 'title.captura.editar' | trans }}{% endblock %}

{% block titular %}{{ 'title.captura.editar' | trans }}{% endblock %}

{% block contenido %}

{% if not (is_granted('ROLE_OPERADOR_PROPIO') or
           (is_granted('ROLE_OPERADOR_EXTERNO_PRUEBAS') and captura.creadoPor and (captura.creadoPor.id == app.user.id))) %}
    <strong>{{ 'captura.error.no_permiso_edicion' | trans }}</strong>
{% else %}

    {% set submenu = 'captura_modificar' %}
    {% include 'captura/includes/cabecera.html.twig' %}
    <div id="subtabs">
        {{ form_start(formulario) }}

            {{ form_errors(formulario) }}
        <fieldset>
            <legend>{{ 'captura.mensaje.datos_captura' | trans }}</legend>
            {{ form_row(formulario.tipoCaptura) }}
            <div>
                {{ form_label(formulario.fechaCaptura) }}
                {{ form_widget(formulario.fechaCaptura, {'attr': {'class': 'corto'}}) }} <em>(dd/mm/aaaa)</em>
                {{ form_errors(formulario.fechaCaptura) }}
            </div>
            <div>
                {{ form_label(formulario.horaCaptura) }}
                {{ form_widget(formulario.horaCaptura, {'attr': {'class': 'corto'}}) }} <em>(hh:mm)</em>
                {{ form_errors(formulario.horaCaptura) }}
            </div>
            {{ form_row(formulario.lugarCaptura, {'attr': {'class': 'largo'}}) }}
            {{ form_row(formulario.observaciones, {'attr': {'class': 'largo'}}) }}
        </fieldset>

        <div id="cortinilla" class="cortinilla"></div>

        {% if captura.path %}
        <div id="superpuesto" class="superpuesto"><img src="{{ asset('uploads/capturas/C-' ~ captura.id ~ '.' ~ captura.path) }}" /></div>
        {% endif %}

        <fieldset>
            <legend>{{ 'captura.mensaje.datos_imagenes' | trans }}</legend>

            {% if captura.path %}
            <div class="centrado lanzador">
                <img src="{{ ('uploads/capturas/C-' ~ captura.id ~ '.' ~ captura.path) | imagine_filter('thumbnail') }}" />
            </div>
            {% endif %}

            {{ form_row(formulario.imagen, {'attr': {'class': 'largo'}}) }}
            {% if captura.path is not null %}
                {{ form_row(formulario.borrarImagen, {'attr': {'class': 'corto'}}) }}
            {% else %}
                {{ form_row(formulario.borrarImagen, {'attr': {'disabled': 'disabled', 'class': 'corto'}}) }}
            {% endif %}
            {{ form_row(formulario.fotosURL, {'attr': {'class': 'largo'}}) }}
        </fieldset>

            {{ form_row(formulario.enviar) }}
            {{ form_rest(formulario) }}
        {{ form_end(formulario) }}
    </div>

    <fieldset>
        <div><strong>{{ 'captura.campo.creado_por' | trans}}:</strong> <em>{% if creado_por %}{{ creado_por }}{% endif %}</em>{% if creado_el is not null %} - {{ creado_el | date("d/m/Y H:i") }}{% endif %}</div>
        <div><strong>{{ 'captura.campo.modificado_por' | trans}}:</strong> <em>{% if modificado_por %}{{ modificado_por }}{% endif %}</em>{% if modificado_el is not null %} - {{ modificado_el | date("d/m/Y H:i") }}{% endif %}</div>
    </fieldset>
{% endif %}
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const lanzador = document.querySelector('.lanzador');
    const cortinilla = document.getElementById('cortinilla');
    const superpuesto = document.getElementById('superpuesto');

    if (lanzador) {
        function mostrarImagen() {
            const imagen = superpuesto.querySelector('img');

            cortinilla.style.display = 'block';
            cortinilla.style.opacity = '1';
            superpuesto.style.display = 'block';
            superpuesto.style.opacity = '1';

            const ancho = imagen.width;
            const alto = imagen.height;
            superpuesto.style.width = ancho + 'px';
            superpuesto.style.height = alto + 'px';
            superpuesto.style.marginLeft = -Math.floor(ancho / 2) + 'px';
            superpuesto.style.marginTop = -Math.floor(alto / 2) + 'px';
        }

        function ocultarSuperpuesto() {
            cortinilla.style.display = 'none';
            cortinilla.style.opacity = '0';
            superpuesto.style.display = 'none';
            superpuesto.style.opacity = '0';
        }

        lanzador.addEventListener('click', function(e) {
            e.preventDefault();
            mostrarImagen();
        });

        cortinilla.addEventListener('click', function(e) {
            e.preventDefault();
            ocultarSuperpuesto();
        });
    }
});
</script>
{% endblock %}
